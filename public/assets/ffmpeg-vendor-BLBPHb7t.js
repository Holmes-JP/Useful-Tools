var n;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(n||(n={}));const O=(()=>{let r=0;return()=>r++})(),D=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),u=new Error("called FFmpeg.terminate()");class N{#e=null;#a={};#r={};#n=[];#s=[];loaded=!1;#o=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:e,data:a}})=>{switch(e){case n.LOAD:this.loaded=!0,this.#a[t](a);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.FFPROBE:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#a[t](a);break;case n.LOG:this.#n.forEach(s=>s(a));break;case n.PROGRESS:this.#s.forEach(s=>s(a));break;case n.ERROR:this.#r[t](a);break}delete this.#a[t],delete this.#r[t]})};#t=({type:t,data:e},a=[],s)=>this.#e?new Promise((i,d)=>{const o=O();this.#e&&this.#e.postMessage({id:o,type:t,data:e},a),this.#a[o]=i,this.#r[o]=d,s?.addEventListener("abort",()=>{d(new DOMException(`Message # ${o} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(D);on(t,e){t==="log"?this.#n.push(e):t==="progress"&&this.#s.push(e)}off(t,e){t==="log"?this.#n=this.#n.filter(a=>a!==e):t==="progress"&&(this.#s=this.#s.filter(a=>a!==e))}load=({classWorkerURL:t,...e}={},{signal:a}={})=>(this.#e||(this.#e=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("worker-BAOIWoxA.js",import.meta.url).href,import.meta.url),{type:"module"}),this.#o()),this.#t({type:n.LOAD,data:e},void 0,a));exec=(t,e=-1,{signal:a}={})=>this.#t({type:n.EXEC,data:{args:t,timeout:e}},void 0,a);ffprobe=(t,e=-1,{signal:a}={})=>this.#t({type:n.FFPROBE,data:{args:t,timeout:e}},void 0,a);terminate=()=>{const t=Object.keys(this.#r);for(const e of t)this.#r[e](u),delete this.#r[e],delete this.#a[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,e,{signal:a}={})=>{const s=[];return e instanceof Uint8Array&&s.push(e.buffer),this.#t({type:n.WRITE_FILE,data:{path:t,data:e}},s,a)};mount=(t,e,a)=>{const s=[];return this.#t({type:n.MOUNT,data:{fsType:t,options:e,mountPoint:a}},s)};unmount=t=>{const e=[];return this.#t({type:n.UNMOUNT,data:{mountPoint:t}},e)};readFile=(t,e="binary",{signal:a}={})=>this.#t({type:n.READ_FILE,data:{path:t,encoding:e}},void 0,a);deleteFile=(t,{signal:e}={})=>this.#t({type:n.DELETE_FILE,data:{path:t}},void 0,e);rename=(t,e,{signal:a}={})=>this.#t({type:n.RENAME,data:{oldPath:t,newPath:e}},void 0,a);createDir=(t,{signal:e}={})=>this.#t({type:n.CREATE_DIR,data:{path:t}},void 0,e);listDir=(t,{signal:e}={})=>this.#t({type:n.LIST_DIR,data:{path:t}},void 0,e);deleteDir=(t,{signal:e}={})=>this.#t({type:n.DELETE_DIR,data:{path:t}},void 0,e)}var l;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(l||(l={}));const L=new Error("failed to get response body reader"),w=new Error("failed to complete download"),I="Content-Length",A=r=>new Promise((t,e)=>{const a=new FileReader;a.onload=()=>{const{result:s}=a;s instanceof ArrayBuffer?t(new Uint8Array(s)):t(new Uint8Array)},a.onerror=s=>{e(Error(`File could not be read! Code=${s?.target?.error?.code||-1}`))},a.readAsArrayBuffer(r)}),m=async r=>{let t;if(typeof r=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?t=atob(r.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(r)).arrayBuffer();else if(r instanceof URL)t=await(await fetch(r)).arrayBuffer();else if(r instanceof File||r instanceof Blob)t=await A(r);else return new Uint8Array;return new Uint8Array(t)},_=async(r,t)=>{const e=await fetch(r);let a;try{const s=parseInt(e.headers.get(I)||"-1"),i=e.body?.getReader();if(!i)throw L;const d=[];let o=0;for(;;){const{done:E,value:R}=await i.read(),c=R?R.length:0;if(E){if(s!=-1&&s!==o)throw w;t&&t({url:r,total:s,received:o,delta:c,done:E});break}d.push(R),o+=c,t&&t({url:r,total:s,received:o,delta:c,done:E})}const f=new Uint8Array(o);let h=0;for(const E of d)f.set(E,h),h+=E.length;a=f.buffer}catch(s){console.log("failed to send download progress event: ",s),a=await e.arrayBuffer()}return a},b=async(r,t,e=!1,a)=>{const s=e?await _(r,a):await(await fetch(r)).arrayBuffer(),i=new Blob([s],{type:t});return URL.createObjectURL(i)};export{N as F,m as f,b as t};
